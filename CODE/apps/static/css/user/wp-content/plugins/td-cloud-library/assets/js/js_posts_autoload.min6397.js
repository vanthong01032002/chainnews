var tdbAutoload={};
(function(c,d,p){var q=c(document),k=c(d);c("body");tdbAutoload={original_post_id:null,is_ajax_running:!1,init:function(){var a=c("#tdb-autoload-article");if(0!==a.length){var h=c(".td-footer-wrapper").outerHeight(),b=c(".td-sub-footer-container").outerHeight(),n=a.data("autoload"),m=a.data("autoload-type"),f=a.data("autoload-count"),e=a.data("autoload-org-post-id"),g=e,r=0;tdbAutoload.original_post_id=e;tdbAutoload.log("%c tdbAutoload(inf) art. settings","background: #ffaa00; color: #ffffff; padding:3px 6px");tdbAutoload.log("tdbAutoload status: "+
n);tdbAutoload.log("tdbAutoload type: "+m);tdbAutoload.log("tdbAutoload original post id: "+e);tdbAutoload.log("tdbAutoload count: "+parseInt(f,10));m=p.debounce(function(){tdbAutoload.log("ajax autoload > scroll");!0!==tdbAutoload.is_ajax_running&&(!f||r<parseInt(f,10))&&k.scrollTop()>=q.height()-k.height()-h-b&&e===g&&(tdbAutoload._ajaxLoadingStart(a),tdbAutoload.is_ajax_running=!0,c.ajax({timeout:5E4,type:"POST",url:tdbAutoload._getRestEndPoint("td-cloud-library/ajax_autoload","uid="+tdbAutoload._getUniqueID()),
beforeSend:function(a){a.setRequestHeader("X-WP-Nonce",d.tdb_globals.wpRestNonce);e=null},data:{currentPostId:g,originalPostId:tdbAutoload.original_post_id},success:function(l,b,h){console.group("API: td-cloud-library/ajax_autoload");console.log("Post: ",{currentPostId:g,originalPostId:tdbAutoload.original_post_id});console.log("Reply: ",l);console.groupEnd();null===l?console.log("td-cloud-library/ajax_autoload - ERROR",[{type:"AJAX ERROR",message:"Empty response received from server.",debug_data:{endpoint:"td-cloud-library/ajax_autoload",
request:h}}]):void 0!==l.error?console.log("td-cloud-library/ajax_autoload - ERROR",l.error):void 0!==l.noPosts?(tdbAutoload._ajaxLoadingEnd(a),console.log("td-cloud-library/ajax_autoload - There are no more articles available!",l.noPosts)):(r++,b=c(l.article),c(b).appendTo(a.find(".tdc-content-wrap")),g=e=l.id,b.filter("#tdb-infinte-post-"+g+"-iframe").load(function(){var b=c(this);tdbAutoload.is_ajax_running=!1;tdbAutoload._ajaxLoadingEnd(a);b.css("opacity",1);setTimeout(function(){var a=b.contents().find("html").outerHeight(!0)+
2;tdbAutoload.log("initial iframe load height set to: "+a);b.height(a)},50);b.contents().find("html").attr("id",b.attr("id"));var e=d.MutationObserver||d.WebKitMutationObserver||d.MozMutationObserver,l=document.querySelector("#"+b.attr("id")),h=(l.contentDocument||l.contentWindow.document).getElementsByTagName("html"),g=p.debounce(function(){var a=h[0].offsetHeight;tdbAutoload.log("setHeight: height set to: "+a);b.height(a)},10);(new e(function(a){a.forEach(function(a){tdbAutoload.log("mutation occurred!");
tdbAutoload.log(a);g()})})).observe(h[0],{childList:!0,subtree:!0})}))},error:function(a,b,c){console.log("td-cloud-library/ajax_autoload - ERROR",[{type:"AJAX ERROR",message:"Invalid reply from server endpoint.",debug_data:{endpoint:"td-cloud-library/ajax_autoload - ERROR",request:a}}]);void 0!==a.responseText?console.log("%cAPI ERROR td-cloud-library/ajax_autoload","background: #ffaa00; color: #ffffff; padding:3px 6px","Error - check for php warnings:",a.responseText):console.log("%cAPI ERROR td-cloud-library/ajax_autoload",
"background: #ffaa00; color: #ffffff; padding:3px 6px","Error - check for php warnings:",a,b,c)}}))},100);var t=p.debounce(function(){tdbAutoload.log("ajax_autoload > resize");c(".tdb-autoload-wrap").find(".tdb-infinte-post-iframe").each(function(){var a=c(this);a.height(a.contents().find("html").outerHeight())})},100),u=p.debounce(function(){tdbAutoload.log("ajax autoload > scroll location change");tdbAutoload._locationChange()},10);"on"===n&&(k.scroll(m),k.scroll(u),k.resize(t))}},_locationChange:function(){var a=
k.scrollTop(),h=a+k.height(),b=[];c(".tdb-autoload-wrap").find("article, iframe").each(function(){var e=c(this),g=e.offset().top-(c(".td-header-menu-wrap.td-affix").outerHeight()+c("#wpadminbar").outerHeight()),d=e.outerHeight(!0),f=e.data("post-url"),k=e.data("post-edit-url");e=e.data("post-title");d=g+d;g<a&&d>h?b.push({top:g,bottom:d,post_url:f,post_edit_url:k,post_title:e}):g>a&&g<h?b.push({top:g,bottom:d,post_url:f,post_edit_url:k,post_title:e}):d>a&&d<h&&b.push({top:g,bottom:d,post_url:f,post_edit_url:k,
post_title:e})});if(0===b.length){var n=d.location.href;var m=d.tdb_globals.origPostEditUrl;var f=document.title}else 1===b.length?(f=b.pop(),n=f.post_url,m=f.post_edit_url,f=f.post_title):(n=b[0].post_url,m=b[0].post_edit_url,f=b[0].post_title);tdbAutoload._updatePostURL(n,m,f)},_updatePostURL:function(a,h,b){d.location.href!==a&&""!==a&&(d.history.replaceState(null,null,a),document.title=b,d.tdb_globals.isAdminBarShowing&&c("#wp-admin-bar-edit").find("a").attr("href",h))},_ajaxLoadingStart:function(a){c(".td-loader-gif").remove();
a.find(".tdc-content-wrap").append('<div class="td-loader-gif td-loader-animation-start tdb-loader-autoload"></div>');tdLoadingBox.init(tds_theme_color_site_wide);setTimeout(function(){c(".td-loader-gif").removeClass("td-loader-animation-start").addClass("td-loader-animation-mid")},50)},_ajaxLoadingEnd:function(a){a.find(".td-loader-gif").removeClass("td-loader-animation-mid").addClass("td-loader-animation-end");setTimeout(function(){a.find(".td-loader-gif").remove();tdLoadingBox.stop()},400)},_getRestEndPoint:function(a,
c){return p.isEmpty(d.tdb_globals.permalinkStructure)?d.tdb_globals.wpRestUrl+a+"&"+c:d.tdb_globals.wpRestUrl+a+"?"+c},_getUniqueID:function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},log:function(a,c){}};q.ready(function(){tdbAutoload.init()})})(jQuery,this,_);
